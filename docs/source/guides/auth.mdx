---
title: Authorization with Apollo MCP Server
---

<PlanRequired plans={["Developer", "Standard", "Enterprise"]}/>

The Apollo MCP server supports authorizing clients (e.g. LLMs) in accordance with [the MCP specification](https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization).

To implement authorization, you need:
- An [OAuth 2.1-compliant](https://oauth.net/2.1/) Identity Provider (for example, your own in-house IdP or a third-party IdP such as Auth0, Okta, or Keycloak)
- A GraphOS Router [configured to use JWT authentication](/graphos/routing/security/jwt)
- Apollo MCP server [configured with `auth` settings](/apollo-mcp-server/command-reference#auth)

The bulk of the setup is done in the Identity Provider. The MCP server and the GraphOS Router is then configured to use this Identity Provider for authorization. Check your Identity Provider's documentation for specific instructions. You need the following information from your Identity Provider:

- **URL**: The base URL of your Identity Provider, which is used to validate the JWTs issued by it.
- **Audience**: The audience for which the JWTs are intended. This is typically the identifier of your API or application.
- **Scopes**: The scopes that the client will request. These scopes define the permissions granted to the client when it accesses the API.

## Example: Auth0 and MCP Inspector

In this guide, we'll walk through setting up the Apollo MCP server with Auth0 as the Identity Provider and using the MCP Inspector to test the authentication flow.

### Pre-requisites

1. [Create an Apollo account](https://studio.apollographql.com/signup?referrer=docs-content).

    <PlanRequired plans={["Developer", "Standard", "Enterprise"]} />

1. Clone the repo for our example project.

    ```sh showLineNumbers=false
    git clone git@github.com:apollographql/apollo-mcp-server.git
    ```

1. Install or update the Rover CLI. You need at least `v0.35`.

    ```sh showLineNumbers=false
    curl -sSL https://rover.apollo.dev/download/latest | sh
    ```

### Step 1: Set up the Auth0 Identity Provider

[Create an Auth0 account](https://auth0.com/).

#### Create the Auth0 API

1. In your dashboard, navigate to **Applications** -> **APIs**. 
1. Click **Create API** .
1. Give it a friendly name like `MCP Auth API`.
1. For the **Identifier** field, Auth0 recommends using a URL. This identifier will be used in the MCP server configuration later on as the `audience` property. For this guide, you can use `http://localhost:5000/mcp-example`.
1. Leave the defaults for the rest of the fields and hit **Create**.
1. Navigate to your dashboard **Settings**.
    1. Under **General** -> **API Authorization Settings**, set the **Default Audience** to the `Identifier` you chose.
    1. Navigate to the **Advanced** tab.
    1. Toggle on **OIDC Dynamic Application Registration** to enable [dynamic client registration](https://auth0.com/docs/get-started/applications/dynamic-client-registration#enable-dynamic-client-registration).
    1. Toggle on **Enable Application Connections**.
    1. Save your changes.

#### Create the Auth0 Connection

The Auth0 Connection is the method clients will use to authenticate. This guide uses the default **Username-Password-Authentication** connection, but you can use any connection that suits your needs (e.g., social logins, enterprise connections).

1. In your dashboard, navigate to **Authentication** -> **Database**.
1. Create the default **Username-Password-Authentication** connection. Click the **Try Connection** button to test it out.
1. Copy the **Connection Identifier** at the top of the page, you need it for the next step. It should start with something like `con_`.
1. Navigate to **Applications** -> **APIs** -> **Auth0 Management API**.
1. Click on the **API Explorer** tab. Copy the token value, you also need it for the next step.
1. Run the cURL command below to promote the connection to domain-level, replacing `CONNECTION_ID` and `MGMT_API_ACCESS_TOKEN` with the values you copied earlier.

    ```sh
    curl --request PATCH \
      --url 'https://dev-p7nxaluy3f2ss4js.us.auth0.com/api/v2/connections/CONNECTION_ID' \
      --header 'authorization: Bearer MGMT_API_ACCESS_TOKEN' \
      --header 'cache-control: no-cache' \
      --header 'content-type: application/json' \
      --data '{ "is_domain_connection": true }'
    ```

Your Auth0 setup is now complete. You have an API with an audience and a connection for authentication.

### Step 2: Configure the MCP Server for authorization

Configure the MCP server to use the Auth0 instance for authentication.

1. Open up the example repo you cloned earlier.
1. In the `graphql/TheSpaceDevs` directory, open up the `config.yaml` file.
1. Add the following `auth` configuration under the `transport` key:

    ```yaml title="graphql/TheSpaceDevs/config.yaml" {3-10}
    transport:
      type: streamable_http
      auth:
        servers:
          - https://<AUTH0 DOMAIN> # Fill in your Auth0 domain
        audiences:
          - <AUTH0 DEFAULT AUDIENCE> # Fill in your Identifier
        resource: http://127.0.0.1:5000/mcp
        scopes:
          - read:users # Adjust scopes as needed
    ```

1. Replace the `<AUTH0 DOMAIN>` with your own Auth0 domain. It should look something like `dev-123456.us.auth0.com`, where `dev-123456` is your Auth0 tenant ID.

1. Replace the `<AUTH0 DEFAULT AUDIENCE>` with the matching `Identifier` you set when creating the Auth0 API. In this guide, you used `http://localhost:5000/mcp-example`

Your MCP server is now configured to use Auth0 for authentication.

### Step 3: Configure the router for JWT authentication

Configure your GraphOS Router to validate JWTs issued by Auth0. This involves setting up the JWKS endpoint and defining the authorization rules.

#### Define authorization and authentication rules in the router

1. In the `graphql/TheSpaceDevs` directory, create a new file called `router.yaml`.
1. Paste the following configuration, replacing `<AUTH0 DOMAIN>` with your Auth0 domain:

    ```yaml title="graphql/TheSpaceDevs/router.yaml"
    authorization:
      require_authentication: true # Enforces authentication on all requests
    authentication:
      router:
        jwt:
          jwks:
            - url: https://<AUTH0 DOMAIN>/.well-known/jwks.json
    homepage:
      enabled: false
    sandbox:
      enabled: true
    supergraph:
      introspection: true
    ```

    With this configuration, the router will require authentication for all requests. If no Authorization token is provided, the router will return an `UNAUTHENTICATED` error.

#### Retrieve your GraphOS license credentials for auth

You need a graph's credentials and a valid GraphOS plan to use the router's auth features.

1. Navigate to [GraphOS Studio](https://studio.apollographql.com/) and log in.
1. Click **Add graph** and **Connect an existing graph**. 
1. Give it a name and click **Next**.
1. In the modal that appears, you'll see a command that looks something like this:

    ```sh showLineNumbers=false {2}
    APOLLO_KEY=<YOUR_APOLLO_KEY> \
    rover subgraph publish <YOUR_APOLLO_GRAPH_REF> \
    --schema ./products-schema.graphql \
    --name your-subgraph-name \
    --routing-url http://products.prod.svc.cluster.local:4001/graphql
    ```

    You do not need to run this command.

1. Retrieve the values for `YOUR_APOLLO_KEY` and `YOUR_APOLLO_GRAPH_REF`.

#### Run the MCP Server and router

1. Back in your terminal, in the root of the project directory, replace and run the following command to start the MCP Server and the router together:

    ```sh
    APOLLO_GRAPH_REF=<YOUR_APOLLO_GRAPH_REF> APOLLO_KEY=<YOUR_APOLLO_KEY> \
    rover dev --supergraph-config ./graphql/TheSpaceDevs/supergraph.yaml \
    --router-config ./graphql/TheSpaceDevs/router.yaml \
    --mcp ./graphql/TheSpaceDevs/config.yaml
    ```

1. Test the router by navigating to `http://localhost:4000` in your browser. You should see the Explorer, where you can run GraphQL queries against the router.

1. Remember, the router is configured to require authentication on all requests. Any operations without a valid authorization token will fail. Run the operation: 

    ```graphql
    query GetAstronautsCurrentlyInSpace {
      astronauts(filters: { inSpace: true, search: "" }) {
        results {
          id
          name
          timeInSpace
          lastFlight
        }
      }
    }
    ```

1. You should see an `UNAUTHENTICATED` error, which means the router is correctly enforcing authentication. Great! Now you can proceed to test the authentication with an MCP client.

### Step 4: Make requests with MCP Inspector

1. In a new terminal window, run the MCP Inspector:

    ```sh
    npx @modelcontextprotocol/inspector
    ```

    The browser should open automatically with a proxy auth token.

1. In the MCP Inspector, select `Streamable HTTP` as the Transport Type and enter `http://127.0.0.1:5000/mcp` as the URL.
1. Click **Connect**. This will trigger the OAuth flow, and you'll be redirected to the Auth0 login page.
1. Log in with the credentials you set up in the Auth0 connection and allow MCP Inspector access.
1. Once connected, the browser will redirect back to MCP Inspector.
1. Click **List Tools** to see the available tools. 
1. Select the `GetAstronautsCurrentlyInSpace` tool listed and click **Run Tool**.
1. You should see the results of the query, which means the authentication is working correctly!

You can select the **Auth** tab in MCP Inspector to see the details of the authenticated user and the scopes granted.

## Troubleshooting

TODO